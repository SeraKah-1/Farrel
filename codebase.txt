This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
app/
  admin/
    page.tsx
  api/
    generate/
      route.ts
  play/
    [id]/
      page.tsx
    page.tsx
  favicon.ico
  globals.css
  layout.tsx
  page.tsx
components/
  ui/
    badge.tsx
    button.tsx
    card.tsx
    dialog.tsx
    input.tsx
    navbar.tsx
    skeleton.tsx
    sonner.tsx
lib/
  schemas.ts
  supabase.ts
  utils.ts
public/
  sounds/
    click.mp3
    correct.mp3
    flatline.mp3
    wrong.mp3
  file.svg
  globe.svg
  next.svg
  vercel.svg
  window.svg
utils/
  supabase/
    client.ts
    server.ts
.gitignore
components.json
eslint.config.mjs
git
next.config.ts
package.json
postcss.config.mjs
README.md
tailwind.config.ts
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/admin/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabase';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Trash2, Edit, Plus, PlayCircle } from 'lucide-react';
import { toast } from 'sonner';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import Link from 'next/link'; // Import Link buat tombol Play

export default function AdminDashboard() {
  const [cards, setCards] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  
  // State untuk Generate Baru
  const [topic, setTopic] = useState('');
  const [isGenerating, setIsGenerating] = useState(false);
  const [openDialog, setOpenDialog] = useState(false);

  // 1. Ambil data saat halaman dibuka
  useEffect(() => {
    fetchCards();
  }, []);

  async function fetchCards() {
    setLoading(true);
    const { data, error } = await supabase
      .from('disease_cards')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) toast.error('Gagal ambil data');
    else setCards(data || []);
    setLoading(false);
  }

  // 2. Fungsi Hapus Kartu
  async function handleDelete(id: string) {
    if (!confirm('Yakin mau hapus kartu ini?')) return;
    
    const { error } = await supabase.from('disease_cards').delete().eq('id', id);
    if (error) {
      toast.error('Gagal menghapus');
    } else {
      toast.success('Kartu dihapus');
      fetchCards(); // Refresh list
    }
  }

  // 3. Fungsi Generate Baru
  async function handleGenerate() {
    if (!topic) return;
    setIsGenerating(true);
    toast.info("AI sedang bekerja...");

    try {
      const res = await fetch('/api/generate-card', {
        method: 'POST',
        body: JSON.stringify({ topic }),
      });
      const data = await res.json();
      if (data.error) throw new Error(data.error);

      toast.success("Kartu baru jadi!");
      setOpenDialog(false); // Tutup popup
      setTopic('');         // Reset input
      fetchCards();         // Refresh list otomatis
    } catch (e: any) {
      toast.error(e.message);
    } finally {
      setIsGenerating(false);
    }
  }

  return (
    <div className="max-w-5xl mx-auto p-6 space-y-8">
      {/* Header */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">Admin Dashboard</h1>
          <p className="text-slate-500">Kelola database penyakit dan skenario game.</p>
        </div>

        {/* Tombol + Popup Generate Baru */}
        <Dialog open={openDialog} onOpenChange={setOpenDialog}>
          <DialogTrigger asChild>
            <Button className="gap-2">
              <Plus size={16} /> Generate Kasus Baru
            </Button>
          </DialogTrigger>
          <DialogContent>
            <DialogHeader>
              <DialogTitle>Minta AI Buat Kasus</DialogTitle>
            </DialogHeader>
            <div className="space-y-4 py-4">
              <div className="space-y-2">
                <label className="text-sm font-medium">Topik / Nama Penyakit</label>
                <Input 
                  placeholder="Misal: Gagal Jantung Kongestif" 
                  value={topic}
                  onChange={(e) => setTopic(e.target.value)}
                />
              </div>
              <Button onClick={handleGenerate} disabled={isGenerating} className="w-full">
                {isGenerating ? 'Sedang Berpikir...' : 'Generate Sekarang'}
              </Button>
            </div>
          </DialogContent>
        </Dialog>
      </div>

      {/* Grid Daftar Kartu */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {loading ? (
          <p>Loading data...</p>
        ) : cards.length === 0 ? (
          <p className="text-slate-500 col-span-3 text-center py-10">Belum ada kartu. Klik Generate dulu!</p>
        ) : (
          cards.map((card) => (
            <Card key={card.id} className="group hover:border-slate-400 transition-all">
              <CardHeader className="pb-3">
                <div className="flex justify-between items-start">
                  <Badge variant={card.status === 'published' ? 'default' : 'secondary'}>
                    {card.status}
                  </Badge>
                  <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <Button variant="ghost" size="icon" className="h-8 w-8 text-red-500" onClick={() => handleDelete(card.id)}>
                      <Trash2 size={14} />
                    </Button>
                  </div>
                </div>
                <CardTitle className="text-lg leading-tight mt-2">{card.title}</CardTitle>
                <CardDescription>{card.category} ‚Ä¢ {card.difficulty}</CardDescription>
              </CardHeader>
              
              <CardContent>
                <div className="text-xs text-slate-500 line-clamp-3 mb-4 bg-slate-50 p-2 rounded">
                  {card.content?.simulation?.chief_complaint_pool?.[0] || "No preview"}...
                </div>
                <div className="flex gap-2">
                  <Button variant="outline" className="w-full text-xs" disabled>
                    <Edit size={12} className="mr-2" /> Edit (Soon)
                  </Button>
                  
                  {/* Tombol Play yang sudah diperbaiki */}
                  <Link href={`/play/${card.id}`}>
                    <Button size="icon" variant="secondary" className="shrink-0">
                      <PlayCircle size={16} />
                    </Button>
                  </Link>

                </div>
              </CardContent>
            </Card>
          ))
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/play/[id]/page.tsx">
'use client';

import { useEffect, useState, use } from 'react';
import { supabase } from '@/lib/supabase';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardFooter } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton'; // Import Skeleton
import { Activity, Thermometer, TestTube, MessageCircle, HeartPulse, Stethoscope, BookOpen, AlertCircle, CheckCircle, Volume2 } from 'lucide-react';
import { toast } from 'sonner';
import { useRouter } from 'next/navigation';
import useSound from 'use-sound'; // Import Audio

export default function GameRoom({ params }: { params: Promise<{ id: string }> }) {
  const resolvedParams = use(params);
  const id = resolvedParams.id;
  const router = useRouter();

  // --- AUDIO HOOKS ---
  // Pastikan file mp3 ada di folder public/sounds/
  const [playClick] = useSound('/sounds/click.mp3', { volume: 0.5 });
  const [playCorrect] = useSound('/sounds/correct.mp3', { volume: 0.5 });
  const [playWrong] = useSound('/sounds/wrong.mp3', { volume: 0.5 });
  const [playFlatline] = useSound('/sounds/flatline.mp3', { volume: 0.4 });

  const [card, setCard] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  // --- GAME STATE ---
  const [energy, setEnergy] = useState(100); 
  const [logs, setLogs] = useState<{sender: string, text: string, type: 'info'|'chat'|'alert'|'success'}[]>([]);
  const [askedQuestions, setAskedQuestions] = useState<number[]>([]); 
  const [dataRevealed, setDataRevealed] = useState({ vitals: false, labs: false });
  const [gameState, setGameState] = useState<'playing' | 'won' | 'lost'>('playing');

  const COSTS = { ASK: 10, VITALS: 25, LABS: 40 };

  useEffect(() => {
    async function fetchGame() {
      // Simulasi delay sedikit biar Skeleton kelihatan keren (opsional)
      await new Promise(r => setTimeout(r, 1000)); 
      
      const { data } = await supabase.from('disease_cards').select('*').eq('id', id).single();
      if (data) {
        setCard(data);
        setLogs([{ 
          sender: 'System', 
          text: `PASIEN BARU MASUK. Keluhan: "${data.content.simulation.chief_complaint}"`, 
          type: 'info' 
        }]);
      }
      setLoading(false);
    }
    fetchGame();
  }, [id]);

  useEffect(() => {
    const el = document.getElementById('chat-container');
    if (el) el.scrollTop = el.scrollHeight;
  }, [logs]);

  const addLog = (sender: string, text: string, type: 'info'|'chat'|'alert'|'success') => {
    setLogs(prev => [...prev, { sender, text, type }]);
  };

  const consumeEnergy = (amount: number) => {
    if (energy - amount < 0) {
      playFlatline(); // Sound Effect: Meninggal
      toast.error("ENERGI HABIS!");
      setGameState('lost');
      addLog('System', 'Dokter kelelahan. Pasien dirujuk ke RS lain (GAME OVER).', 'alert');
      setEnergy(0);
      return false;
    }
    setEnergy(prev => prev - amount);
    return true;
  };

  const handleAsk = (index: number, q: any) => {
    if (gameState !== 'playing') return;
    playClick(); // Sound Effect: Klik
    if (!consumeEnergy(COSTS.ASK)) return;

    setAskedQuestions(prev => [...prev, index]);
    addLog('Dokter', q.question, 'chat');
    
    setTimeout(() => {
      if (q.is_relevant) {
        addLog('Pasien', q.answer, 'chat');
      } else {
        addLog('Pasien', `${q.answer} (Pasien tampak bingung)`, 'chat');
        toast.warning("Pertanyaan kurang relevan.");
      }
    }, 600);
  };

  const revealData = (type: 'vitals' | 'labs') => {
    if (gameState !== 'playing') return;
    playClick(); // Sound Effect: Klik
    const cost = type === 'vitals' ? COSTS.VITALS : COSTS.LABS;
    
    if (!dataRevealed[type]) {
      if (!consumeEnergy(cost)) return;
      setDataRevealed(prev => ({ ...prev, [type]: true }));
      addLog('System', type === 'vitals' ? "Perawat memeriksa tanda vital..." : "Sampel darah dikirim ke lab...", 'info');
    }
  };

  const handleGuess = (option: string) => {
    if (gameState !== 'playing') return;

    const correctAnswer = card.content.simulation.diagnosis_answer;
    
    if (option === correctAnswer) {
      playCorrect(); // Sound Effect: Menang
      setGameState('won');
      addLog('System', `üèÜ DIAGNOSA TEPAT! (${correctAnswer}). Pasien selamat.`, 'success');
      toast.success("SEMPURNA! Pasien Selamat.");
    } else {
      playWrong(); // Sound Effect: Salah
      const penalty = 50;
      toast.error("DIAGNOSA SALAH!");
      addLog('System', `‚ùå SALAH! Bukan ${option}. Kondisi pasien kritis! (-${penalty} Energi)`, 'alert');
      
      if (energy - penalty <= 0) {
        playFlatline(); // Sound Effect: Meninggal
        setEnergy(0);
        setGameState('lost');
        addLog('System', 'Pasien meninggal karena salah penanganan.', 'alert');
      } else {
        setEnergy(prev => prev - penalty);
      }
    }
  };

  // --- TAMPILAN SKELETON (LOADING) ---
  if (loading) {
    return (
      <div className="max-w-6xl mx-auto p-4 font-sans h-[calc(100vh-2rem)] flex flex-col md:flex-row gap-4">
        {/* Kiri Skeleton */}
        <div className="flex-1 flex flex-col gap-4 h-full">
          <Skeleton className="h-24 w-full rounded-xl" /> {/* Energy Bar */}
          <Skeleton className="flex-1 w-full rounded-xl" /> {/* Chat Area */}
        </div>
        {/* Kanan Skeleton */}
        <div className="w-full md:w-[400px] flex flex-col gap-3">
          <Skeleton className="h-40 w-full rounded-xl" />
          <Skeleton className="h-32 w-full rounded-xl" />
          <Skeleton className="h-32 w-full rounded-xl" />
          <Skeleton className="h-48 w-full rounded-xl mt-auto" />
        </div>
      </div>
    );
  }
  
  const sim = card.content.simulation;
  const wiki = card.content.wiki;

  return (
    <div className="max-w-6xl mx-auto p-4 font-sans min-h-[calc(100vh-2rem)] flex flex-col md:flex-row gap-4">
      
      {/* --- PANEL KIRI (Log & Edukasi) --- */}
      <div className="flex-1 flex flex-col gap-4 h-full">
        {/* Energy Bar */}
        <Card className="bg-slate-900 text-white border-none shadow-xl shrink-0">
          <CardContent className="p-4 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className={`p-2 rounded-full ${energy < 30 ? 'bg-red-600 animate-pulse' : 'bg-blue-600'}`}>
                <HeartPulse size={24} className="text-white" />
              </div>
              <div>
                <p className="text-xs text-slate-400 font-bold uppercase tracking-wider">Stamina Dokter</p>
                <div className="w-full md:w-64 h-3 bg-slate-800 rounded-full mt-1 overflow-hidden">
                  <div 
                    className={`h-full transition-all duration-700 ease-out ${energy < 30 ? 'bg-red-500' : energy < 60 ? 'bg-amber-400' : 'bg-green-500'}`} 
                    style={{ width: `${energy}%` }}
                  />
                </div>
              </div>
            </div>
            <div className="text-right">
              <span className="text-3xl font-black">{energy}</span>
              <span className="text-sm text-slate-500">/100 AP</span>
            </div>
          </CardContent>
        </Card>

        {/* LOG GAMEPLAY */}
        <Card className={`bg-slate-50 border-slate-200 overflow-hidden flex flex-col shadow-inner transition-all duration-500 ${gameState !== 'playing' ? 'h-[300px]' : 'flex-1'}`}>
          <CardHeader className="py-3 px-4 bg-white border-b flex flex-row items-center gap-2">
            <Activity size={16} className="text-slate-400"/> 
            <span className="text-sm font-bold text-slate-600">Rekam Medis & Observasi</span>
          </CardHeader>
          <div id="chat-container" className="flex-1 overflow-y-auto p-4 space-y-3 scroll-smooth">
            {logs.map((log, i) => (
              <div key={i} className={`flex flex-col max-w-[90%] ${log.sender === 'Dokter' ? 'ml-auto items-end' : 'items-start'}`}>
                {log.sender !== 'System' && (
                  <span className="text-[10px] font-bold text-slate-400 mb-1 px-1">{log.sender}</span>
                )}
                <div className={`px-4 py-2 rounded-2xl text-sm shadow-sm ${
                  log.sender === 'Dokter' ? 'bg-blue-600 text-white rounded-tr-none' : 
                  log.sender === 'System' ? 'w-full max-w-full text-center bg-slate-200 text-slate-600 rounded-lg text-xs font-mono py-1' :
                  log.type === 'alert' ? 'bg-red-100 text-red-800 border border-red-200' :
                  log.type === 'success' ? 'bg-green-100 text-green-800 border border-green-200 font-bold' :
                  'bg-white text-slate-800 border border-slate-100 rounded-tl-none'
                }`}>
                  {log.text}
                </div>
              </div>
            ))}
          </div>
        </Card>

        {/* üî• FITUR EDUKASI (Hanya Muncul Saat Game Selesai) */}
        {gameState !== 'playing' && (
          <Card className="border-blue-200 shadow-xl border-t-4 border-t-blue-500 animate-in slide-in-from-bottom-10 fade-in duration-700">
            <CardHeader className="pb-2 bg-blue-50/50">
               <CardTitle className="flex items-center gap-2 text-blue-900">
                 <BookOpen className="w-5 h-5"/> Laporan Medis & Pembahasan
               </CardTitle>
            </CardHeader>
            <CardContent className="p-6 space-y-6">
              <div className="flex items-start gap-4">
                <div className="bg-slate-100 p-3 rounded-lg min-w-[120px] text-center">
                   <p className="text-xs text-slate-500 uppercase font-bold">Diagnosa Benar</p>
                   <p className="text-lg font-black text-blue-600 leading-tight mt-1">{sim.diagnosis_answer}</p>
                </div>
                <div>
                   <p className="text-sm text-slate-700 font-medium leading-relaxed">
                     <span className="font-bold text-slate-900">Definisi:</span> {wiki.definition}
                   </p>
                </div>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-1">
                   <h4 className="text-xs font-bold text-slate-400 uppercase flex items-center gap-1"><AlertCircle size={12}/> Gejala Khas</h4>
                   <ul className="text-sm text-slate-700 list-disc list-inside bg-slate-50 p-2 rounded">
                     {wiki.clinical_signs.map((s: string, i: number) => <li key={i}>{s}</li>)}
                   </ul>
                </div>
                <div className="space-y-1">
                   <h4 className="text-xs font-bold text-slate-400 uppercase flex items-center gap-1"><CheckCircle size={12}/> Penanganan</h4>
                   <p className="text-sm text-slate-700 bg-green-50 p-2 rounded border border-green-100">
                     {wiki.treatment_guideline}
                   </p>
                </div>
              </div>
            </CardContent>
            <CardFooter className="bg-slate-50 pt-4">
               <Button className="w-full h-12 text-lg font-bold" onClick={() => router.push('/play')}>
                 Tangani Pasien Berikutnya üëâ
               </Button>
            </CardFooter>
          </Card>
        )}
      </div>

      {/* --- PANEL KANAN (Actions) --- */}
      <div className="w-full md:w-[400px] flex flex-col gap-3 h-full overflow-y-auto pr-1">
        
        {/* WAWANCARA */}
        <Card className={`border-l-4 border-l-blue-500 transition-all duration-500 ${gameState !== 'playing' ? 'opacity-40 pointer-events-none grayscale' : ''}`}>
          <CardHeader className="py-2 px-4 bg-blue-50/50">
            <CardTitle className="text-sm text-blue-800 flex justify-between items-center">
              <span className="flex items-center gap-2"><MessageCircle size={16}/> Wawancara</span>
              <span className="text-xs bg-blue-200 px-2 py-0.5 rounded text-blue-800">-{COSTS.ASK} AP</span>
            </CardTitle>
          </CardHeader>
          <CardContent className="p-3 space-y-2">
            {sim.interview_questions?.map((q: any, i: number) => (
              <Button 
                key={i} 
                variant="outline" 
                size="sm"
                className={`w-full justify-start h-auto py-2 text-xs text-left whitespace-normal ${askedQuestions.includes(i) ? 'bg-slate-100 text-slate-400 line-through' : 'hover:border-blue-500 hover:bg-blue-50'}`}
                onClick={() => handleAsk(i, q)}
                disabled={askedQuestions.includes(i)}
              >
                {q.question}
              </Button>
            ))}
          </CardContent>
        </Card>

        {/* PERIKSA FISIK */}
        <Card className={`border-l-4 border-l-amber-500 transition-all duration-500 ${gameState !== 'playing' ? 'opacity-40 pointer-events-none grayscale' : ''}`}>
          <CardHeader className="py-2 px-4 bg-amber-50/50">
            <CardTitle className="text-sm text-amber-800 flex justify-between items-center">
              <span className="flex items-center gap-2"><Thermometer size={16}/> Tanda Vital</span>
              <span className="text-xs bg-amber-200 px-2 py-0.5 rounded text-amber-800">-{COSTS.VITALS} AP</span>
            </CardTitle>
          </CardHeader>
          <CardContent className="p-3">
            {!dataRevealed.vitals ? (
              <Button className="w-full bg-amber-600 hover:bg-amber-700 text-white" onClick={() => revealData('vitals')}>
                Lakukan Pemeriksaan
              </Button>
            ) : (
              <div className="grid grid-cols-2 gap-2 text-sm bg-amber-50 p-2 rounded border border-amber-200">
                <div><span className="text-slate-500 text-xs">Tensi</span><br/><b>{sim.vital_signs.systolic}/{sim.vital_signs.diastolic}</b></div>
                <div><span className="text-slate-500 text-xs">Nadi</span><br/><b>{sim.vital_signs.heart_rate} bpm</b></div>
                <div><span className="text-slate-500 text-xs">Suhu</span><br/><b>{sim.vital_signs.temperature}¬∞C</b></div>
                <div><span className="text-slate-500 text-xs">Napas</span><br/><b>{sim.vital_signs.resp_rate} x/m</b></div>
              </div>
            )}
          </CardContent>
        </Card>

        {/* LAB */}
        <Card className={`border-l-4 border-l-purple-500 transition-all duration-500 ${gameState !== 'playing' ? 'opacity-40 pointer-events-none grayscale' : ''}`}>
          <CardHeader className="py-2 px-4 bg-purple-50/50">
            <CardTitle className="text-sm text-purple-800 flex justify-between items-center">
              <span className="flex items-center gap-2"><TestTube size={16}/> Laboratorium</span>
              <span className="text-xs bg-purple-200 px-2 py-0.5 rounded text-purple-800">-{COSTS.LABS} AP</span>
            </CardTitle>
          </CardHeader>
          <CardContent className="p-3">
            {!dataRevealed.labs ? (
              <Button className="w-full bg-purple-600 hover:bg-purple-700 text-white" onClick={() => revealData('labs')}>
                Ambil Sampel Darah
              </Button>
            ) : (
              <div className="bg-purple-50 p-2 rounded border border-purple-200 text-xs space-y-2">
                <p className="font-bold text-purple-900 border-b border-purple-200 pb-1">HASIL ABNORMAL:</p>
                {sim.lab_abnormalities?.length > 0 ? sim.lab_abnormalities.map((lab: any, i: number) => (
                  <div key={i} className="flex justify-between items-center">
                    <span>{lab.name}</span>
                    <span className="font-bold text-red-600 bg-red-50 px-1 rounded">{lab.value}</span>
                  </div>
                )) : <p className="text-slate-500 italic">Tidak ditemukan kelainan signifikan.</p>}
              </div>
            )}
          </CardContent>
        </Card>

        {/* DIAGNOSA */}
        <Card className={`border-l-4 border-l-slate-800 bg-slate-50 shadow-md mt-auto transition-all duration-500 ${gameState !== 'playing' ? 'opacity-40 pointer-events-none grayscale' : ''}`}>
          <CardHeader className="py-2 px-4 bg-slate-800 text-white">
            <CardTitle className="text-sm flex items-center gap-2">
              <Stethoscope size={16}/> Tentukan Diagnosa
            </CardTitle>
          </CardHeader>
          <CardContent className="p-2 space-y-2">
             {sim.diagnosis_options?.map((option: string, i: number) => (
              <Button 
                key={i} 
                variant="secondary" 
                className="w-full justify-start text-xs h-auto py-3 whitespace-normal bg-white border border-slate-200 hover:bg-slate-800 hover:text-white transition-colors"
                onClick={() => handleGuess(option)}
              >
                {option}
              </Button>
            ))}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
</file>

<file path="app/globals.css">
@import "tailwindcss";

/* Pastikan package tw-animate-css sudah terinstall. Jika error, hapus baris ini */
@import "tw-animate-css"; 

@plugin "tailwindcss-animate";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --radius-2xl: calc(var(--radius) + 8px);
  --radius-3xl: calc(var(--radius) + 12px);
  --radius-4xl: calc(var(--radius) + 16px);
}

/* Deklarasi Variabel Warna (Mode Terang) */
:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.141 0.005 285.823);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.141 0.005 285.823);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.141 0.005 285.823);
  --primary: oklch(0.21 0.006 285.885);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.967 0.001 286.375);
  --secondary-foreground: oklch(0.21 0.006 285.885);
  --muted: oklch(0.967 0.001 286.375);
  --muted-foreground: oklch(0.552 0.016 285.938);
  --accent: oklch(0.967 0.001 286.375);
  --accent-foreground: oklch(0.21 0.006 285.885);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.92 0.004 286.32);
  --input: oklch(0.92 0.004 286.32);
  --ring: oklch(0.705 0.015 286.067);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.141 0.005 285.823);
  --sidebar-primary: oklch(0.21 0.006 285.885);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.967 0.001 286.375);
  --sidebar-accent-foreground: oklch(0.21 0.006 285.885);
  --sidebar-border: oklch(0.92 0.004 286.32);
  --sidebar-ring: oklch(0.705 0.015 286.067);
}

/* Deklarasi Variabel Warna (Mode Gelap) */
.dark {
  --background: oklch(0.141 0.005 285.823);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.21 0.006 285.885);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.21 0.006 285.885);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.92 0.004 286.32);
  --primary-foreground: oklch(0.21 0.006 285.885);
  --secondary: oklch(0.274 0.006 286.033);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.274 0.006 286.033);
  --muted-foreground: oklch(0.705 0.015 286.067);
  --accent: oklch(0.274 0.006 286.033);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.552 0.016 285.938);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.21 0.006 285.885);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.274 0.006 286.033);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.552 0.016 285.938);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
</file>

<file path="components/ui/badge.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant = "default",
  size = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      data-variant={variant}
      data-size={size}
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 outline-none sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}
</file>

<file path="components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="components/ui/navbar.tsx">
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Stethoscope, Home, LayoutGrid, Plus } from 'lucide-react';

export function Navbar() {
  const pathname = usePathname();

  return (
    <nav className="bg-white border-b border-slate-200 px-4 md:px-6 py-3 flex items-center justify-between sticky top-0 z-50 shadow-sm">
      {/* Logo Kiri */}
      <Link href="/" className="flex items-center gap-2 hover:opacity-80 transition">
        <div className="bg-blue-600 text-white p-1.5 rounded-lg shadow-sm">
          <Stethoscope size={20} />
        </div>
        <span className="font-bold text-slate-800 text-lg hidden sm:block">Medical Detective</span>
      </Link>

      {/* Menu Kanan */}
      <div className="flex gap-2 md:gap-3">
        <Link href="/">
          <Button variant={pathname === "/" ? "secondary" : "ghost"} size="sm" className="gap-2">
            <Home className="w-4 h-4" />
            <span className="hidden sm:inline">Home</span>
          </Button>
        </Link>
        
        <Link href="/play">
          <Button variant={pathname.startsWith("/play") ? "default" : "ghost"} size="sm" className="gap-2">
            <LayoutGrid className="w-4 h-4" />
            <span className="hidden sm:inline">Lobby Kasus</span>
          </Button>
        </Link>
      </div>
    </nav>
  );
}
</file>

<file path="components/ui/skeleton.tsx">
import { cn } from "@/lib/utils"

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  )
}

export { Skeleton }
</file>

<file path="components/ui/sonner.tsx">
"use client"

import {
  CircleCheckIcon,
  InfoIcon,
  Loader2Icon,
  OctagonXIcon,
  TriangleAlertIcon,
} from "lucide-react"
import { useTheme } from "next-themes"
import { Toaster as Sonner, type ToasterProps } from "sonner"

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      icons={{
        success: <CircleCheckIcon className="size-4" />,
        info: <InfoIcon className="size-4" />,
        warning: <TriangleAlertIcon className="size-4" />,
        error: <OctagonXIcon className="size-4" />,
        loading: <Loader2Icon className="size-4 animate-spin" />,
      }}
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
          "--border-radius": "var(--radius)",
        } as React.CSSProperties
      }
      {...props}
    />
  )
}

export { Toaster }
</file>

<file path="lib/schemas.ts">
import { z } from 'zod';

// 1. Schema Materi Belajar (Wiki) - Tetap
export const EducationSchema = z.object({
  definition: z.string().describe("Definisi singkat penyakit"),
  etiology: z.string().describe("Penyebab utama"),
  clinical_signs: z.array(z.string()).describe("Daftar 3-5 tanda klinis utama"),
  pathophysiology_summary: z.string().describe("Ringkasan patofisiologi"),
  treatment_guideline: z.string().describe("Prinsip penatalaksanaan"),
});

// 2. Schema Game Logic (BARU: Mode Detektif)
export const SimulationSchema = z.object({
  chief_complaint: z.string().describe("Keluhan utama pasien saat datang (1 kalimat)"),
  
  // Dialog Pilihan Ganda
  interview_questions: z.array(z.object({
    question: z.string().describe("Pertanyaan yang bisa dipilih dokter"),
    answer: z.string().describe("Jawaban pasien"),
    is_relevant: z.boolean().describe("True jika pertanyaan ini mengarah ke diagnosa, False jika basa-basi/menjebak"),
  })).describe("Buat 6 pertanyaan: 3 sangat relevan (poin penting), 3 pengecoh (tidak relevan)"),

  // Data Fisik Pasti (Bukan Range lagi, biar gampang ditampilkan)
  vital_signs: z.object({
    systolic: z.number(),
    diastolic: z.number(),
    heart_rate: z.number(),
    temperature: z.number(),
    resp_rate: z.number(),
  }),

  // Hasil Lab (Hanya yang abnormal/kunci)
  lab_abnormalities: z.array(z.object({
    name: z.string().describe("Nama parameter (misal: Leukosit)"),
    value: z.string().describe("Nilai & Satuan (misal: 25.000 /uL)"),
    interpretation: z.string().describe("Interpretasi singkat (misal: Tinggi)"),
  })).describe("List 3-4 hasil lab yang TIDAK NORMAL saja"),

  diagnosis_answer: z.string().describe("Kunci jawaban diagnosa yang benar"),
  
  // Pilihan Ganda Diagnosa
  diagnosis_options: z.array(z.string()).describe("4 Pilihan Diagnosa (1 Benar, 3 Salah tapi mirip gejalanya)"),
});

export const DiseaseCardContentSchema = z.object({
  wiki: EducationSchema,
  simulation: SimulationSchema,
});
</file>

<file path="lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

// Mengambil kunci dari .env.local
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

// Membuat client untuk interaksi ke DB
export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="lib/utils.ts">
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="utils/supabase/client.ts">
import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
</file>

<file path="utils/supabase/server.ts">
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export async function createClient() {
  // üëá PERUBAHAN UTAMA: Tambahkan 'await' di sini
  const cookieStore = await cookies() 

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        // üëá Method baru untuk Next.js 15+ (pakai getAll dan setAll)
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch {
            // Error ini bisa diabaikan kalau dipanggil dari Server Component
          }
        },
      },
    }
  )
}
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "zinc",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="git">

</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="tailwind.config.ts">
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  // PERHATIKAN BAGIAN CONTENT INI
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/**/*.{js,ts,jsx,tsx,mdx}", // Jaga-jaga kalau ada folder src
    "./lib/**/*.{js,ts,jsx,tsx,mdx}", 
  ],
  theme: {
    extend: {
      backgroundImage: {
        "gradient-radial": "radial-gradient(var(--tw-gradient-stops))",
        "gradient-conic":
          "conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))",
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      colors: {
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        chart: {
          "1": "hsl(var(--chart-1))",
          "2": "hsl(var(--chart-2))",
          "3": "hsl(var(--chart-3))",
          "4": "hsl(var(--chart-4))",
          "5": "hsl(var(--chart-5))",
        },
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};
export default config;
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*
.env
.env.local
.env.*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
};

export default config;
</file>

<file path="app/api/generate/route.ts">
import { NextResponse } from 'next/server';
import OpenAI from 'openai';
// ‚úÖ Import Correct: Mundur 3 langkah ke root utils
import { createClient } from '@/utils/supabase/server'; 

// Konfigurasi durasi timeout (Penting untuk Vercel supaya tidak putus saat AI mikir)
export const maxDuration = 60; 
export const dynamic = 'force-dynamic';

export async function POST(req: Request) {
  try {
    const { topic, difficulty } = await req.json();

    const openai = new OpenAI({
      apiKey: process.env.OPENAI_API_KEY,
    });

    // Prompt Engineering untuk Dokter AI
    const systemPrompt = `
      Kamu adalah Dokter Senior yang ahli membuat studi kasus medis untuk mahasiswa kedokteran.
      Tugasmu adalah membuat 1 kasus pasien fiktif yang realistis.
      
      Format output HARUS JSON valid dengan struktur persis seperti ini:
      {
        "title": "Judul Kasus (Singkat & Menarik)",
        "patient": {
          "name": "Nama Pasien",
          "age": 30,
          "gender": "Laki-laki/Perempuan",
          "history": "Riwayat penyakit singkat (1-2 kalimat)"
        },
        "symptoms": ["Gejala 1", "Gejala 2", "Gejala 3"],
        "lab_results": ["Tensi: 120/80", "Suhu: 38C", "Leukosit: Tinggi"],
        "correct_diagnosis": "Nama Penyakit (Diagnosa Benar)",
        "differential_diagnosis": ["Penyakit Salah 1", "Penyakit Salah 2", "Penyakit Salah 3"],
        "explanation": "Penjelasan medis singkat kenapa diagnosa ini benar.",
        "difficulty": "${difficulty === 'random' ? 'Medium' : difficulty}"
      }
    `;

    const userPrompt = topic 
      ? `Buat kasus spesifik tentang penyakit: ${topic}. Level kesulitan: ${difficulty}.`
      : `Buat kasus penyakit penyakit umum di Indonesia (misal: Tropis, Infeksi, Metabolik). Level kesulitan: ${difficulty}.`;

    const completion = await openai.chat.completions.create({
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userPrompt },
      ],
      model: "gpt-4o-mini", // Model hemat & cepat
      response_format: { type: "json_object" },
    });

    const content = completion.choices[0].message.content;
    if (!content) throw new Error("AI tidak memberikan respon");

    const gameData = JSON.parse(content);

    // Simpan ke Database Supabase
    // üëá PENTING: Gunakan await untuk Next.js versi terbaru
    const supabase = await createClient(); 
    
    const { data, error } = await supabase
      .from('disease_cards')
      .insert([
        {
          title: gameData.title,
          difficulty: gameData.difficulty,
          correct_diagnosis: gameData.correct_diagnosis,
          scenario: { // Simpan sisa data sebagai JSONB
            patient: gameData.patient,
            symptoms: gameData.symptoms,
            lab_results: gameData.lab_results,
            // Gabungkan opsi benar + salah, lalu acak
            options: [gameData.correct_diagnosis, ...gameData.differential_diagnosis].sort(() => Math.random() - 0.5),
            explanation: gameData.explanation
          }
        }
      ])
      .select()
      .single();

    if (error) {
      console.error('Supabase Error:', error);
      throw new Error("Gagal menyimpan ke database");
    }

    return NextResponse.json({ success: true, id: data.id });

  } catch (error: any) {
    console.error('API Error:', error);
    return NextResponse.json(
      { success: false, error: error.message || "Internal Server Error" }, 
      { status: 500 }
    );
  }
}
</file>

<file path="package.json">
{
  "name": "meds-game",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@ai-sdk/openai": "^1.1.0",
    "@radix-ui/react-dialog": "^1.1.4",
    "@radix-ui/react-slot": "^1.1.1",
    "@supabase/ssr": "^0.5.2",
    "@supabase/supabase-js": "^2.47.10",
    "ai": "^4.0.22",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "lucide-react": "^0.469.0",
    "next": "15.1.3",
    "next-themes": "^0.4.4",
    "openai": "^4.77.0",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "sonner": "^1.7.1",
    "tailwind-merge": "^2.6.0",
    "tailwindcss": "^4.0.0-beta.9",
    "tailwindcss-animate": "^1.0.7",
    "use-sound": "^4.0.3",
    "zod": "^3.24.1",
    "zustand": "^5.0.2"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.0.0-beta.9",
    "@types/node": "^20.17.10",
    "@types/react": "^19.0.2",
    "@types/react-dom": "^19.0.2",
    "eslint": "^9.17.0",
    "eslint-config-next": "15.1.3",
    "postcss": "^8.4.49",
    "typescript": "^5.7.2"
  }
}
</file>

<file path="app/page.tsx">
'use client';

import { useEffect, useState } from 'react';
// ‚úÖ Import Correct: Mundur 2 langkah ke root utils
import { createClient } from '@/utils/supabase/client'; 
import { Button } from '@/components/ui/button';
import Link from 'next/link';
import { Card, CardHeader, CardTitle, CardDescription, CardFooter } from '@/components/ui/card';
import { Plus, Play, Loader2, Sparkles, Target, X, AlertCircle } from 'lucide-react';
import { toast } from 'sonner';
import { useRouter } from 'next/navigation';

export default function LobbyPage() {
  // --- STATE ---
  const [cases, setCases] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [generating, setGenerating] = useState(false);
  
  // State untuk Popup (Modal) Request Kasus
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [customTopic, setCustomTopic] = useState("");
  const [selectedDifficulty, setSelectedDifficulty] = useState("random");

  const supabase = createClient();
  const router = useRouter();

  // --- EFFECT ---
  useEffect(() => {
    fetchCases();
  }, []);

  // --- FUNCTIONS ---
  async function fetchCases() {
    const { data, error } = await supabase
      .from('disease_cards')
      .select('id, title, difficulty, created_at')
      .order('created_at', { ascending: false });

    if (!error) setCases(data || []);
    setLoading(false);
  }

  const handleGenerate = async () => {
    setGenerating(true);
    // Jangan tutup modal dulu biar user tau loading
    
    const toastId = toast.loading("Sedang menghubungi AI Dokter...");

    try {
      // Kirim request ke API
      const res = await fetch('/api/generate', { 
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          topic: customTopic, 
          difficulty: selectedDifficulty 
        })
      });
      
      const data = await res.json();
      
      if (data.success) {
        toast.dismiss(toastId);
        toast.success("Pasien baru siap diperiksa!");
        
        setIsModalOpen(false); // Tutup modal
        fetchCases(); // Refresh list
        
        // Langsung arahkan user ke halaman main
        router.push(`/play/${data.id}`);
        
        // Reset form modal
        setCustomTopic("");
        setSelectedDifficulty("random");
      } else {
        throw new Error(data.error || "Gagal membuat kasus");
      }
    } catch (err) {
      console.error(err);
      toast.dismiss(toastId);
      toast.error("Gagal membuat kasus. Coba lagi nanti.");
    } finally {
      setGenerating(false);
    }
  };

  // --- RENDER ---
  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8">
      <div className="max-w-5xl mx-auto space-y-8">
        
        {/* HEADER */}
        <div className="flex flex-col md:flex-row justify-between items-center gap-4">
          <div>
            <h1 className="text-3xl font-bold text-slate-900">Lobby Praktek</h1>
            <p className="text-slate-500">Pilih pasien untuk memulai diagnosa hari ini.</p>
          </div>
          
          {/* Tombol Buka Modal */}
          <Button 
            onClick={() => setIsModalOpen(true)} 
            size="lg" 
            className="bg-blue-600 hover:bg-blue-700 shadow-md transition-all"
          >
            <Plus className="mr-2 h-5 w-5" /> Terima Pasien Baru
          </Button>
        </div>

        {/* --- MODAL POPUP (REQUEST KASUS) --- */}
        {isModalOpen && (
          <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm animate-in fade-in duration-200">
            <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100">
              
              {/* Header Modal */}
              <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 className="font-bold text-lg text-slate-800">Buat Skenario Pasien</h3>
                <button 
                  onClick={() => !generating && setIsModalOpen(false)} 
                  className="text-slate-400 hover:text-red-500 transition-colors disabled:opacity-50"
                  disabled={generating}
                >
                  <X size={20} />
                </button>
              </div>

              {/* Body Modal */}
              <div className="p-6 space-y-5">
                {/* Input Topik */}
                <div className="space-y-2">
                  <label className="text-sm font-medium text-slate-700">Keluhan / Penyakit (Opsional)</label>
                  <input 
                    type="text" 
                    placeholder="Contoh: Demam Berdarah, Jantung..."
                    className="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm transition-all"
                    value={customTopic}
                    onChange={(e) => setCustomTopic(e.target.value)}
                    disabled={generating}
                  />
                  <p className="text-xs text-slate-400">Biarkan kosong jika ingin penyakit acak.</p>
                </div>

                {/* Input Difficulty */}
                <div className="space-y-2">
                  <label className="text-sm font-medium text-slate-700">Tingkat Kesulitan</label>
                  <div className="grid grid-cols-4 gap-2">
                    {['random', 'Easy', 'Medium', 'Hard'].map((diff) => (
                      <button
                        key={diff}
                        onClick={() => setSelectedDifficulty(diff)}
                        disabled={generating}
                        className={`text-sm py-2 px-1 rounded-lg border transition-all ${
                          selectedDifficulty === diff 
                            ? 'bg-blue-50 border-blue-500 text-blue-700 font-bold ring-1 ring-blue-500' 
                            : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'
                        }`}
                      >
                        {diff === 'random' ? 'Acak' : diff}
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              {/* Footer Modal */}
              <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                <Button variant="ghost" onClick={() => setIsModalOpen(false)} disabled={generating}>
                  Batal
                </Button>
                <Button 
                  onClick={handleGenerate} 
                  disabled={generating} 
                  className="bg-slate-900 text-white hover:bg-slate-800 min-w-[140px]"
                >
                  {generating ? (
                    <><Loader2 className="mr-2 h-4 w-4 animate-spin" /> Meracik...</>
                  ) : customTopic ? (
                    <><Target className="mr-2 h-4 w-4" /> Request Spesifik</>
                  ) : (
                    <><Sparkles className="mr-2 h-4 w-4" /> Surprise Me</>
                  )}
                </Button>
              </div>
            </div>
          </div>
        )}

        {/* --- LIST KASUS YANG SUDAH ADA --- */}
        {loading ? (
          <div className="flex flex-col items-center justify-center py-20 text-slate-400 gap-4">
             <Loader2 className="h-8 w-8 animate-spin text-blue-500" />
             <p>Mengambil berkas pasien...</p>
          </div>
        ) : cases.length === 0 ? (
          <div className="text-center py-24 bg-white rounded-xl border-2 border-dashed border-slate-200">
            <div className="bg-slate-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
              <AlertCircle className="h-8 w-8 text-slate-400" />
            </div>
            <h3 className="text-xl font-semibold text-slate-900">Belum ada kasus</h3>
            <p className="text-slate-500 mt-2 mb-6 max-w-sm mx-auto">
              Klinik sedang sepi. Klik tombol <strong>"Terima Pasien Baru"</strong> di pojok kanan atas untuk mulai bermain.
            </p>
          </div>
        ) : (
          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {cases.map((game) => (
              <Card 
                key={game.id} 
                className="hover:border-blue-400 hover:shadow-lg transition-all duration-300 cursor-pointer group relative overflow-hidden" 
                onClick={() => router.push(`/play/${game.id}`)}
              >
                <div className="absolute top-0 left-0 w-1 h-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity" />
                
                <CardHeader className="pb-3">
                  <div className="flex justify-between items-start gap-2">
                    <CardTitle className="text-lg leading-snug group-hover:text-blue-700 transition-colors line-clamp-2">
                      {game.title || "Kasus Tanpa Nama"}
                    </CardTitle>
                  </div>
                  <CardDescription className="flex items-center gap-2 mt-2">
                    <span className={`text-xs px-2 py-1 rounded-full font-medium border ${
                      game.difficulty === 'Hard' ? 'bg-red-50 text-red-600 border-red-200' : 
                      game.difficulty === 'Medium' ? 'bg-yellow-50 text-yellow-600 border-yellow-200' : 
                      'bg-green-50 text-green-600 border-green-200'
                    }`}>
                      {game.difficulty || "Normal"}
                    </span>
                    <span className="text-xs text-slate-400">‚Ä¢ {new Date(game.created_at).toLocaleDateString('id-ID')}</span>
                  </CardDescription>
                </CardHeader>
                
                <CardFooter className="pt-0">
                  <Button variant="secondary" className="w-full bg-slate-100 hover:bg-blue-600 hover:text-white transition-colors">
                    <Play className="mr-2 h-4 w-4" /> Mulai Diagnosa
                  </Button>
                </CardFooter>
              </Card>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/play/page.tsx">
'use client';

import { useEffect, useState } from 'react';
// ‚úÖ Import yang sudah diperbaiki (Mundur 2 folder untuk cari utils di root)
import { createClient } from '@/utils/supabase/client';
import { Button } from '@/components/ui/button';
import Link from 'next/link';
import { Card, CardHeader, CardTitle, CardDescription, CardFooter } from '@/components/ui/card';
import { Plus, Play, Loader2, Sparkles, Target, X, AlertCircle } from 'lucide-react';
import { toast } from 'sonner';
import { useRouter } from 'next/navigation';

export default function LobbyPage() {
  // --- STATE ---
  const [cases, setCases] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [generating, setGenerating] = useState(false);
  
  // State untuk Popup (Modal) Request Kasus
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [customTopic, setCustomTopic] = useState("");
  const [selectedDifficulty, setSelectedDifficulty] = useState("random");

  const supabase = createClient();
  const router = useRouter();

  // --- EFFECT ---
  useEffect(() => {
    fetchCases();
  }, []);

  // --- FUNCTIONS ---
  async function fetchCases() {
    const { data, error } = await supabase
      .from('disease_cards')
      .select('id, title, difficulty, created_at')
      .order('created_at', { ascending: false });

    if (!error) setCases(data || []);
    setLoading(false);
  }

  const handleGenerate = async () => {
    setGenerating(true);
    setIsModalOpen(false); // Tutup modal biar rapi
    
    const toastId = toast.loading("Sedang menghubungi AI Dokter...");

    try {
      // Kirim request ke API dengan data Topik & Difficulty
      const res = await fetch('/api/generate', { 
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          topic: customTopic, 
          difficulty: selectedDifficulty 
        })
      });
      
      const data = await res.json();
      
      if (data.success) {
        toast.dismiss(toastId);
        toast.success("Pasien baru siap diperiksa!");
        
        // Refresh list kasus
        fetchCases();
        
        // Langsung arahkan user ke halaman main
        router.push(`/play/${data.id}`);
        
        // Reset form modal
        setCustomTopic("");
        setSelectedDifficulty("random");
      } else {
        throw new Error(data.error || "Gagal membuat kasus");
      }
    } catch (err) {
      console.error(err);
      toast.dismiss(toastId);
      toast.error("Gagal membuat kasus. Coba lagi nanti.");
    } finally {
      setGenerating(false);
    }
  };

  // --- RENDER ---
  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8">
      <div className="max-w-5xl mx-auto space-y-8">
        
        {/* HEADER */}
        <div className="flex flex-col md:flex-row justify-between items-center gap-4">
          <div>
            <h1 className="text-3xl font-bold text-slate-900">Lobby Praktek</h1>
            <p className="text-slate-500">Pilih pasien untuk memulai diagnosa hari ini.</p>
          </div>
          
          {/* Tombol Buka Modal */}
          <Button 
            onClick={() => setIsModalOpen(true)} 
            size="lg" 
            className="bg-blue-600 hover:bg-blue-700 shadow-md transition-all"
          >
            <Plus className="mr-2 h-5 w-5" /> Terima Pasien Baru
          </Button>
        </div>

        {/* --- MODAL POPUP (REQUEST KASUS) --- */}
        {isModalOpen && (
          <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm animate-in fade-in duration-200">
            <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100">
              
              {/* Header Modal */}
              <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 className="font-bold text-lg text-slate-800">Buat Skenario Pasien</h3>
                <button 
                  onClick={() => setIsModalOpen(false)} 
                  className="text-slate-400 hover:text-red-500 transition-colors"
                >
                  <X size={20} />
                </button>
              </div>

              {/* Body Modal */}
              <div className="p-6 space-y-5">
                {/* Input Topik */}
                <div className="space-y-2">
                  <label className="text-sm font-medium text-slate-700">Keluhan / Penyakit (Opsional)</label>
                  <input 
                    type="text" 
                    placeholder="Contoh: Demam Berdarah, Jantung..."
                    className="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm transition-all"
                    value={customTopic}
                    onChange={(e) => setCustomTopic(e.target.value)}
                  />
                  <p className="text-xs text-slate-400">Biarkan kosong jika ingin penyakit acak.</p>
                </div>

                {/* Input Difficulty */}
                <div className="space-y-2">
                  <label className="text-sm font-medium text-slate-700">Tingkat Kesulitan</label>
                  <div className="grid grid-cols-4 gap-2">
                    {['random', 'Easy', 'Medium', 'Hard'].map((diff) => (
                      <button
                        key={diff}
                        onClick={() => setSelectedDifficulty(diff)}
                        className={`text-sm py-2 px-1 rounded-lg border transition-all ${
                          selectedDifficulty === diff 
                            ? 'bg-blue-50 border-blue-500 text-blue-700 font-bold ring-1 ring-blue-500' 
                            : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'
                        }`}
                      >
                        {diff === 'random' ? 'Acak' : diff}
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              {/* Footer Modal */}
              <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                <Button variant="ghost" onClick={() => setIsModalOpen(false)}>
                  Batal
                </Button>
                <Button 
                  onClick={handleGenerate} 
                  disabled={generating} 
                  className="bg-slate-900 text-white hover:bg-slate-800 min-w-[140px]"
                >
                  {generating ? (
                    <><Loader2 className="mr-2 h-4 w-4 animate-spin" /> Meracik...</>
                  ) : customTopic ? (
                    <><Target className="mr-2 h-4 w-4" /> Request Spesifik</>
                  ) : (
                    <><Sparkles className="mr-2 h-4 w-4" /> Surprise Me</>
                  )}
                </Button>
              </div>
            </div>
          </div>
        )}

        {/* --- LIST KASUS YANG SUDAH ADA --- */}
        {loading ? (
          <div className="flex flex-col items-center justify-center py-20 text-slate-400 gap-4">
             <Loader2 className="h-8 w-8 animate-spin text-blue-500" />
             <p>Mengambil berkas pasien...</p>
          </div>
        ) : cases.length === 0 ? (
          <div className="text-center py-24 bg-white rounded-xl border-2 border-dashed border-slate-200">
            <div className="bg-slate-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
              <AlertCircle className="h-8 w-8 text-slate-400" />
            </div>
            <h3 className="text-xl font-semibold text-slate-900">Belum ada kasus</h3>
            <p className="text-slate-500 mt-2 mb-6 max-w-sm mx-auto">
              Klinik sedang sepi. Klik tombol <strong>"Terima Pasien Baru"</strong> di pojok kanan atas untuk mulai bermain.
            </p>
          </div>
        ) : (
          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {cases.map((game) => (
              <Card 
                key={game.id} 
                className="hover:border-blue-400 hover:shadow-lg transition-all duration-300 cursor-pointer group relative overflow-hidden" 
                onClick={() => router.push(`/play/${game.id}`)}
              >
                <div className="absolute top-0 left-0 w-1 h-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity" />
                
                <CardHeader className="pb-3">
                  <div className="flex justify-between items-start gap-2">
                    <CardTitle className="text-lg leading-snug group-hover:text-blue-700 transition-colors">
                      {game.title || "Kasus Tanpa Nama"}
                    </CardTitle>
                  </div>
                  <CardDescription className="flex items-center gap-2 mt-2">
                    <span className={`text-xs px-2 py-1 rounded-full font-medium border ${
                      game.difficulty === 'Hard' ? 'bg-red-50 text-red-600 border-red-200' : 
                      game.difficulty === 'Medium' ? 'bg-yellow-50 text-yellow-600 border-yellow-200' : 
                      'bg-green-50 text-green-600 border-green-200'
                    }`}>
                      {game.difficulty || "Normal"}
                    </span>
                    <span className="text-xs text-slate-400">‚Ä¢ {new Date(game.created_at).toLocaleDateString('id-ID')}</span>
                  </CardDescription>
                </CardHeader>
                
                <CardFooter className="pt-0">
                  <Link href={`/play/${game.id}`} className="w-full">
                    <Button variant="secondary" className="w-full bg-slate-100 hover:bg-blue-600 hover:text-white transition-colors">
                      <Play className="mr-2 h-4 w-4" /> Mulai Diagnosa
                    </Button>
                  </Link>
                </CardFooter>
              </Card>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/layout.tsx">
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import { Toaster } from "@/components/ui/sonner"; // Pastikan path ini benar, atau hapus baris ini jika merah

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Medical Detective",
  description: "Uji kemampuan medismu dalam simulasi kasus penyakit nyata.",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={inter.className}>
        {children}
        <Toaster />
      </body>
    </html>
  );
}
</file>

</files>
